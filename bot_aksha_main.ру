import os
import telebot
import requests
import http.server
import socketserver
import threading

TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(TOKEN)

# --- –§–ï–ô–ö–û–í–´–ô –°–ï–†–í–ï–† –î–õ–Ø RENDER ---
def run_static_server():
    port = int(os.environ.get("PORT", 10000))
    handler = http.server.SimpleHTTPRequestHandler
    with socketserver.TCPServer(("", port), handler) as httpd:
        httpd.serve_forever()

# --- –õ–û–ì–ò–ö–ê –ë–û–¢–ê ---
def get_rate():
    try:
        url = "https://api.exchangerate-api.com/v4/latest/USD"
        return requests.get(url).json()['rates']['KZT']
    except:
        return "–æ—à–∏–±–∫–∞"

@bot.message_handler(commands=['start'])
def start(message):
    rate = get_rate()
    bot.send_message(message.chat.id, f"üíµ –ö—É—Ä—Å: {rate} KZT\nüìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!")

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ, —á—Ç–æ–±—ã Render –Ω–µ —Ä—É–≥–∞–ª—Å—è
threading.Thread(target=run_static_server, daemon=True).start()

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
bot.polling(non_stop=True)
