import os
import telebot
import requests

# –ë–µ—Ä–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Render
TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(TOKEN)

def get_rate():
    """–ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∫—É—Ä—Å USD/KZT"""
    try:
        url = "https://api.exchangerate-api.com/v4/latest/USD"
        response = requests.get(url)
        data = response.json()
        return data['rates']['KZT']
    except Exception as e:
        return f"–æ—à–∏–±–∫–∞ (–Ω–µ —Å–º–æ–≥ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –±–∞–Ω–∫–æ–º)"

@bot.message_handler(commands=['start'])
def start(message):
    current_rate = get_rate()
    text = (
        f"üá∞üáø *–ö—É—Ä—Å USD/KZT –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:*\n"
        f"üíµ 1 –î–æ–ª–ª–∞—Ä = *{current_rate}* —Ç–µ–Ω–≥–µ\n\n"
        f"üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –†—ã–Ω–æ–∫ —Å—Ç–∞–±–∏–ª–µ–Ω. –†–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 2 —á–∞—Å–∞ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è."
    )
    bot.send_message(message.chat.id, text, parse_mode="Markdown")

# –ó–∞–ø—É—Å–∫
print("–ë–æ—Ç –≤—ã—à–µ–ª –Ω–∞ –æ—Ö–æ—Ç—É –∑–∞ –∫—É—Ä—Å–æ–º...")
bot.polling(non_stop=True)
